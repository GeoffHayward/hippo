name: Slack verify

on:
  repository_dispatch:
    types:
      - verify

jobs:

  build:
    name: Build Commit
    runs-on: ubuntu-latest
    timeout-minutes: 90
    env:
      PAYLOAD_CONTEXT: ${{ toJson(github.event.client_payload) }}

    steps:

      #
      # Identify target server
      #
      - name: Identify target
        uses: actions/github-script@v3
        id: find-target
        env:
          AGENT: ${{ github.event.client_payload.integrity.agent }}
          BODY: ${{ github.event.client_payload.integrity.body }}
          TIMESTAMP: ${{ github.event.client_payload.integrity.timestamp }}
          SIGNATURE: ${{ github.event.client_payload.integrity.signature }}
          SIGNING_SECRET: ${{ secrets.SIGNING_SECRET }}
        with:
          result-encoding: string
          script: |
            if(!`${process.env.AGENT}`startsWith("Slackbot")){
              core.setFailed("User agent mismatch.")
            } else {
              return "todo"
            }
